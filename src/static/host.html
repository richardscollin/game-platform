<!DOCTYPE html>
<html>

<head>
    <title>Host Game</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link href="main.css" rel="stylesheet">
    <link href="host.css" rel="stylesheet">
</head>

<body>
    <h1>
        Host Game
    </h1>

    <form class="game-settings">
        <h2>Settings</h2>
        <input type="submit" value="Create Game Room"></input>
        <p class="current-room-code"></p>
        <div class="connect-qr"></div>
        <div>Players:</div>
        <ul class="players-list"></ul>
    </form>

    <script type="module">
        import { hostConfig } from "./utils.js";
        import { GameHost } from "./host.js";
        import qrcodegen from "./lib/qrcodegen.js";

        function main() {
            const formRef = document.querySelector("form");
            const roomCodeRef = document.querySelector(".current-room-code");
            const qrRef = document.querySelector(".connect-qr");
            const playersListRef = document.querySelector(".players-list");

            formRef.addEventListener("submit", (e) => {
                e.preventDefault();
                e.stopPropagation();

                const gameHost = new GameHost(
                    function onRoomCode(roomCode) {
                        roomCodeRef.textContent = roomCode;
                        const url = hostConfig.webRoot + "/?roomCode=" + roomCode;
                        console.log(url);
                        qrRef.innerHTML = qrcodegen.QrCode.encodeText(
                            url,
                            qrcodegen.QrCode.Ecc.LOW
                        ).toSvgString(4);
                    },
                    function onPlayers() {
                        playersListRef.innerHTML = "";

                        for (const player of Object.values(gameHost.players)) {
                            const li = document.createElement("li");
                            li.textContent = `Player ${player.id}:  (${player.x},${player.y
                                }) ${!!player.channel} ${player.updates} ${player.localClock - player.remoteClock
                                } ${player.latency}`;
                            playersListRef.appendChild(li);
                        }
                    }
                );
            });
        }
        window.addEventListener("load", main);
    </script>

</body>

</html>